# Next.js WordPress Starter <!-- omit in toc -->

WebDevStudios fork of the [official Next.js WordPress Example](https://github.com/vercel/next.js/tree/canary/examples/cms-wordpress). Used as a starter for headless WordPress projects.

👉 https://nextjs-wordpress-starter.vercel.app

<a href="https://webdevstudios.com/contact/"><img src="https://webdevstudios.com/wp-content/uploads/2018/04/wds-github-banner.png" alt="WebDevStudios. Your Success is Our Mission."></a>

## 🗂 Table of Contents <!-- omit in toc -->

- [🎓 Preface](#-preface)
- [🚀 Front-end Setup (Next.js)](#-front-end-setup-nextjs)
- [🔧 Back-end Setup (WordPress)](#-back-end-setup-wordpress)
- [💻 Workflow](#-workflow)
  - [Local by Flywheel](#local-by-flywheel)
  - [Migrate DB Pro](#migrate-db-pro)
  - [Deployments](#deployments)
  - [ENV Variables](#env-variables)
  - [Git Branches](#git-branches)
  - [Git Workflow](#git-workflow)
  - [Credentials](#credentials)
  - [WP Engine Environments](#wp-engine-environments)
- [:octocat: Contributing](#octocat-contributing)

---

## 🎓 Preface

You will need the following installed on your computer:

- [Node 12](https://nodejs.org/en/)
- [Yarn](https://yarnpkg.com/)
- [Vercel CLI](https://vercel.com/download)

---

## 🚀 Front-end Setup (Next.js)

The following instructions will standup a local install of Next.js (front-end). It queries data from WordPress (back-end).

**Clone the repo:**

```bash
git clone git@github.com:WebDevStudios/nextjs-wordpress-starter.git
```

**Check out the `staging` branch**

```bash
git checkout staging
```

**Install dependencies:**

```bash
yarn
```

**Create an environment variable file:**

```bash
vercel env pull
```

**Start the development server:**

```bash
yarn dev
```

The frontend is now available at http://localhost:3000

---

## 🔧 Back-end Setup (WordPress)

The backend is hosted at WP Engine. There are 3 environments...please use Develop for working locally.

- [Develop](https://nextjsdevstart.wpengine.com/wp-admin/)
- [Staging](https://nextjsstgstart.wpengine.com/wp-admin/)
- [Production](https://nextjs.wpengine.com/wp-admin)

**Note: There is no frontend for WordPress** - But it is running [wd_s](https://github.com/WebDevStudios/wd_s) which houses `/acf-json` and other functions.

---

## 💻 Workflow

Contributing to this project is a lot like any other WDS project...

### Local by Flywheel

There is an [Local export available](https://drive.google.com/drive/folders/1Ju81KThAUHOuWRNslw_m7xZScwoJYkr0). Simply import the `nextjs-wp-XX.XX.XX.zip` file and you can tinker with the WordPress backend.

### Migrate DB Pro

You can use Migrate DB Pro to pull databases and files. **Please see 1password --> Next.js Starter --> Migrate DB Pro**

### Deployments

[Vercel](https://nextjs-wordpress-starter-gregrickaby.webdevstudios.vercel.app) is connected to this repo and handles builds and deployments.

### ENV Variables

You can download the ENV variables from Vercel with the following commands:

```bash
vercel env pull
```

**Note: You may need to connect your local to Vercel first!**

```bash
vercel
```

And then answer the questions in the command line when prompted.

---

### Git Branches

- `develop` - auto deploys on Vercel
- `staging` - auto deploys on Vercel
- `main` - auto deploys on Vercel
- `Pull Requests` - deployment previews are automatically generated by Vercel

### Git Workflow

1. Create a `feature` branch off `staging`
2. Open a draft Pull Request on Github
3. When finished with your work, fill out the PR template and publish your PR
4. Vercel will create a deployment preview. It must pass and deploy successfully
5. After peer review, PR will be merged back into `staging`
6. Repeat ♻️

### Credentials

- WordPress - `1password --> Next.js Starter --> WordPress`
- To view hosting dashboards, ping Greg

### WP Engine Environments

WP Engine supports [copying environments](https://wpengine.com/support/copy-site/). For example, to copy Develop --> Staging:

1. Log into the WP Engine [User Portal](https://my.wpengine.com/sites)
2. Click on [Nextjsstgstart](https://my.wpengine.com/installs/nextjsstgstart)
3. In the top right corner, click the "Copy environment" button
4. Select the options:
   ![screenshot](https://dl.dropbox.com/s/uvzm2trqbgbpyky/Screen%20Shot%202020-12-21%20at%2011.19.34%20AM.png?dl=0)
5. Click "Preview copy" and a modal will appear to let you verify the options
6. Click "Copy environment"

## :octocat: Contributing

Your [contributions](https://github.com/WebDevStudios/nextjs-wordpress-starter/blob/main/.github/CONTRIBUTING.md) and issues are welcome.
