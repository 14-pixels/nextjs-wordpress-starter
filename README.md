# Next.js WordPress Starter <!-- omit in toc -->

WebDevStudios fork of the [official Next.js WordPress Example](https://github.com/vercel/next.js/tree/canary/examples/cms-wordpress). Used as a starter for headless WordPress projects.

üëâ https://nextjs-wordpress-starter.vercel.app

<a href="https://webdevstudios.com/contact/"><img src="https://webdevstudios.com/wp-content/uploads/2018/04/wds-github-banner.png" alt="WebDevStudios. Your Success is Our Mission."></a>

## üóÇ Table of Contents <!-- omit in toc -->

- [üéì Preface](#-preface)
  - [Dependencies](#dependencies)
  - [Git Branches](#git-branches)
  - [Credentials](#credentials)
- [üöÄ Front-end Setup (Next.js)](#-front-end-setup-nextjs)
  - [Clone this repository](#clone-this-repository)
  - [Link Project with Vercel](#link-project-with-vercel)
  - [Install Front-end](#install-front-end)
  - [Start Dev Server](#start-dev-server)
- [üîß Back-end Setup (WordPress)](#-back-end-setup-wordpress)
  - [Setup Local](#setup-local)
  - [Migrate DB Pro](#migrate-db-pro)
  - [Copy WP Engine Environments](#copy-wp-engine-environments)
- [üíª Development](#-development)
  - [Git Workflow](#git-workflow)
  - [Deployments](#deployments)
  - [Storybook](#storybook)
  - [Chromatic](#chromatic)
- [:octocat: Contributing](#octocat-contributing)

---

## üéì Preface

### Dependencies

You will need the following dependencies installed on your computer:

- [Node 12](https://nodejs.org/en/)
- [Yarn](https://yarnpkg.com/)
- [Vercel CLI](https://vercel.com/download)

### Git Branches

- `develop` - auto deploys on Vercel
- `staging` - auto deploys on Vercel
- `main` - auto deploys on Vercel
- `Pull Requests` - deployment previews are automatically generated by Vercel

### Credentials

- Credentials are in 1password --> Next.js Starter --> WordPress

---

## üöÄ Front-end Setup (Next.js)

The following instructions will standup a local install of Next.js (front-end). It queries data from WordPress (back-end).

### Clone this repository

```bash
git clone git@github.com:WebDevStudios/nextjs-wordpress-starter.git
```

### Link Project with Vercel

If this step fails, you'll most likely need be added to the WDS Team in Vercel first. Learn more about [Project Linking](https://vercel.com/docs/cli#commands/overview/project-linking) with the Vercel CLI.

Install the [Vercel CLI](https://vercel.com/download):

```bash
npm i -g vercel
```

Change directories into this project:

```bash
cd nextjs-wordpress-starter
```

Initialize Vercel by answering the questions in the command line when prompted:

```bash
vercel
```

### Install Front-end

Pull down the ENV vars from Vercel:

```bash
vercel env pull
```

Install dependencies:

```bash
yarn
```

### Start Dev Server

```bash
yarn dev
```

The frontend is now available at http://localhost:3000

---

## üîß Back-end Setup (WordPress)

The backend is hosted at WP Engine. There are 3 environments...please use Develop for working locally.

- [Develop](https://nextjsdevstart.wpengine.com/wp-admin/)
- [Staging](https://nextjsstgstart.wpengine.com/wp-admin/)
- [Production](https://nextjs.wpengine.com/wp-admin)

**Note: There is no frontend for WordPress** - But it is running [wd_s](https://github.com/WebDevStudios/wd_s) which houses `/acf-json` and other functions.

### Setup Local

There is an [Local export available](https://drive.google.com/drive/folders/1Ju81KThAUHOuWRNslw_m7xZScwoJYkr0). Simply import the `nextjs-wp-XX.XX.XX.zip` file and you can tinker with the WordPress backend.

### Migrate DB Pro

You can use Migrate DB Pro to pull databases and files. **Please see 1password --> Next.js Starter --> Migrate DB Pro**

### Copy WP Engine Environments

WP Engine supports [copying environments](https://wpengine.com/support/copy-site/). For example, to copy Develop --> Staging:

1. Log into the WP Engine [User Portal](https://my.wpengine.com/sites)
2. Click on [Nextjsstgstart](https://my.wpengine.com/installs/nextjsstgstart)
3. In the top right corner, click the "Copy environment" button
4. Select the options:
   ![screenshot](https://dl.dropbox.com/s/uvzm2trqbgbpyky/Screen%20Shot%202020-12-21%20at%2011.19.34%20AM.png?dl=0)
5. Click "Preview copy" and a modal will appear to let you verify the options
6. Click "Copy environment"

---

## üíª Development

### Git Workflow

1. Create a `feature` branch off `staging`
2. Open a draft Pull Request on Github
3. When finished with your work, fill out the PR template and publish your PR
4. Vercel will create a deployment preview. It must pass and deploy successfully
5. After peer review, PR will be merged back into `staging`
6. Repeat ‚ôªÔ∏è

### Deployments

[Vercel](https://nextjs-wordpress-starter-gregrickaby.webdevstudios.vercel.app) is connected to this Github repository and automatically builds and deploys. Learn more about [Vercel + Github integration](https://vercel.com/docs/git/vercel-for-github).

### Storybook

To view this project's storybook on your Local:

```bash
yarn storybook
```

View this project's [Storybook](https://staging--5fe0becf19ad53002147b034.chromatic.com/)

### Chromatic

This project supports UI review via Chromatic, which is trigger via Github Actions.

View this project's [Chromatic](https://chromatic.com/library?appId=5fe0becf19ad53002147b034&branch=staging)

---

## :octocat: Contributing

Your [contributions](https://github.com/WebDevStudios/nextjs-wordpress-starter/blob/main/.github/CONTRIBUTING.md) and issues are welcome.
